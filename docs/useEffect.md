# useEffect êµ¬ì¡°

*`useEffect(() â‡’ {}, [*someProp, someState*])`* - ì²«ë²ˆì§¸ ì¸ìë¡œ ì½œë°± í•¨ìˆ˜ë¥¼ ê·¸ë¦¬ê³  ë‘ë²ˆì§¸ ì¸ìë¡œ ì˜ì¡´ì„± ë°°ì—´ì„ ë°›ìŠµë‹ˆë‹¤.

# useEffect() í›…ì€ ì–¸ì œ ì‚¬ìš©í•´ì£¼ë©´ ë ê¹Œ?

- useEffectëŠ” ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ë  ë•Œ ë§ˆë‹¤ íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆëŠ” hookì…ë‹ˆë‹¤.
- ê·¸ë¦¬ê³  react í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ì˜ ë¼ì´í”„ì‚¬ì´í´ ë©”ì„œë“œ ì¼ë¶€ì¸ _`componentDidMount`_ ì™€ _`componentDidUpdate`_ ì„ í•©ì¹œ í˜•íƒœë¡œ ë´ë„ ë¬´ë°©í•©ë‹ˆë‹¤.
  - `componentDidMount` ë©”ì„œë“œ
    - ì˜ì¡´ì„± ë°°ì—´ì„ ë¹ˆ ë°°ì—´ë¡œ ë§Œë“¤ì–´ì„œ ëŒ€ì²´ê°€ëŠ¥

      ```jsx
      React.useEffect(() => {
        console.log('Wecome to Radixweb!')
      }, [])
      ```

    - ex
      - `props`Â ë¡œ ë°›ì€ ê°’ì„ ì»´í¬ë„ŒíŠ¸ì˜ ë¡œì»¬ ìƒíƒœë¡œ ì„¤ì •
      - ì™¸ë¶€ API ìš”ì²­ (REST API ë“±)
      - ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© (D3, Video.js ë“±...)
      - setInterval ì„ í†µí•œ ë°˜ë³µì‘ì—… í˜¹ì€ setTimeout ì„ í†µí•œ ì‘ì—… ì˜ˆì•½
  - _`componentDidUpdate` ë©”ì„œë“œ_
    - ì˜ì¡´ì„± ë°°ì—´ì— ì£¼ì‹œí•˜ê³  ì‹¶ì€ valueë¥¼ ë„£ì–´ì„œ ëŒ€ì²´ ê°€ëŠ¥
      ```jsx
      React.useEffect(() => {
        fetchUser()
      }, [userId])
      ```
  - _`componentWillUnmount` ë©”ì„œë“œ_
    - í´ë¦° ì—…ì„ ì´ìš©í•´ì„œ ì»´í¬ë„ŒíŠ¸ê°€ í™”ë©´ì—ì„œ ì‚¬ë¼ì§ˆ ë•Œë¥¼ ì¸ì‹í•´ì„œ ì¶”ê°€ ì‘ì—… ìˆ˜í–‰ ê°€ëŠ¥
      ```jsx
      React.useEffect(() => {
        console.log('Welcome to Radixweb!')

        return () => {
          console.log('Component unmounts')
        }
      }, [])
      ```
      - ex
      - setInterval, setTimeout ì„ ì‚¬ìš©í•˜ì—¬ ë“±ë¡í•œ ì‘ì—…ë“¤ clear í•˜ê¸° (clearInterval, clearTimeout)
      - ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¸ìŠ¤í„´ìŠ¤ ì œê±°

# ğŸ™ŒÂ  ì˜ì¡´ì„± ë°°ì—´ì˜ í˜•íƒœì— ë”°ë¼ ë‚˜ëˆ  ì •ë¦¬ í•´ ë´¤ì–´ìš”!

1. ë Œë”ë§ì´ ë  ë•Œ ë§ˆë‹¤ (ì¦‰ ì»´í¬ë„ŒíŠ¸ê°€ ë§¨ ì²˜ìŒ í™”ë©´ì— ê·¸ë ¤ì§ˆë•Œ ê·¸ë¦¬ê³  ì»´í¬ë„ŒíŠ¸ê°€ ì—…ë°ì´íŠ¸ ë ë•Œ) ì‹¤í–‰ì‹œí‚¤ê¸°ê³  ì‹¶ì€ ì‘ì—…ì´ ìˆë‹¤ë©´


    - ë‘ë²ˆì§¸ ì¸ìë¡œ ì˜ì¡´ì„± ë°°ì—´ ì—†ì´ ì½œë°± í•¨ìˆ˜ë§Œ ë„£ì–´ì¤€ë‹¤.
      - `useEffect(() â‡’ {})`

2. ì»´í¬ë„ŒíŠ¸ê°€ í™”ë©´ì— ë§¨ ì²˜ìŒ ë Œë”ë§ì´ ë ë•Œ(ë””í´íŠ¸) ê·¸ë¦¬ê³  íŠ¹ì •ê°’(value)ì´ ë°”ë€”ë•Œ ë§ˆë‹¤ ì‹¤í–‰ ì‹œì¼œ ì£¼ê³  ì‹¶ì€ ì‘ì—…ì´ ìˆë‹¤ë©´
   - ì˜ì¡´ì„± ë°°ì—´ì— ì£¼ì‹œí•˜ê³  ì‹¶ì€ íŠ¹ì •ê°’ì„ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.
     - `useEffect(() â‡’ {}, [value])`
3. í™”ë©´ì— ì²˜ìŒ ë Œë”ë§ ë  ë•Œ **í•œ ë²ˆ**ë§Œ ì‹¤í–‰ì‹œì¼œ ì£¼ê³  ì‹¶ì€ ì‘ì—…ì´ ìˆë‹¤ë©´
   - ì˜ì¡´ì„± ë°°ì—´ ë¶€ë¶„ì— [] ë¹ˆ ë°°ì—´ì„ ë„£ì–´ì£¼ë©´ ë©ë‹ˆë‹¤.
     - `useEffect(() â‡’ {}, [])`

# Clean up

- ë§Œì•½ useEffectë¥¼ ì´ìš©í•´ì„œ íƒ€ì´ë¨¸ë¥¼ ì‹œì‘í–ˆë‹¤ë©´ íƒ€ì´ë¨¸ë¥¼ ëë‚´ì£¼ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ê³ , í˜¹ì€ ì–´ë–¤ EventListenerë¥¼ ë“±ë¡í–ˆë‹¤ë©´ ë“±ë¡í•œ ë¦¬ìŠ¤ë„ˆë¥¼ ì •ë¦¬í•´ ì£¼ëŠ” ì‘ì—…ì´ useEffect ë‚´ë¶€ì—ì„œ í•„ìš” í•©ë‹ˆë‹¤.
- ë©”ëª¨ë¦¬ ì¸¡ë©´ì—ì„œë„ ì¢‹ë‹¤.
  - Clean up í•˜ëŠ” ë°©ë²•

    _`return () â‡’ { â€¦ì •ë¦¬ í•˜ê³  ì‹¶ì€ ë‚´ìš© }`_

    - ìƒí™©1. ì–¸ë§ˆìš´íŠ¸ ë  ë•Œ í•œë²ˆë§Œ cleanup í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ ë¹ˆ ë°°ì—´ì„ ë„£ì–´ì£¼ë©´ ë©ë‹ˆë‹¤.
    - ìƒí™©2. íŠ¹ì •ê°’ì´ ì—…ë°ì´íŠ¸ ë˜ê¸° ì§ì „ì— cleanup í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ deps ë°°ì—´ ì•ˆì— ê²€ì‚¬í•˜ê³  ì‹¶ì€ ê°’ì„ ë„£ì–´ì¤ë‹ˆë‹¤.

    ```jsx
    useEffect(() => {
      // ì„¤ì • ...
      return () => {
        // ì •ë¦¬(clean up)
      }
    })
    ```

# useEffect ì‚¬ìš© ì˜ˆì‹œ

1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°(fetching data)

   - ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ axiosë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ , ê·¸ê²ƒì„ stateë¡œ ì €ì¥í•˜ì—¬ í™œìš©í•©ë‹ˆë‹¤.

   ```jsx
   export default () => {
     const [data, setData] = useState({ hits: [] })
     useEffect(async () => {
       const result = await axios.get(
         'https://hn.algolia.com/api/v1/search?query=redux'
       )
       setData(result.data)
     }, [])
     // useEffectì˜ ë‘ë²ˆì§¸ ì¸ìë¡œ ë¹ˆ ë°°ì—´[]ì„ ì£¼ì—ˆìŠµë‹ˆë‹¤.
     return (
       <ul>
         {data.hits.map((item) => (
           <li key={item.objectID}>
             <a href={item.url}>{item.title}</a>
           </li>
         ))}
       </ul>
     )
   }
   ```

- ì´ë ‡ê²Œ í•˜ë©´ `Effect callbacks are synchronous to prevent race conditions. Put the async function inside` ì—ëŸ¬ê°€ ëœ¹ë‹ˆë‹¤.

  - `effect ì½œë°± í•¨ìˆ˜ëŠ” race conditionì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë™ê¸°ì ì´ì–´ì•¼ í•©ë‹ˆë‹¤. asyncë¥¼ ì½œë°± í•¨ìˆ˜ ì•ˆìª½ì— ë„£ìœ¼ì‹­ì‹œì˜¤.`
  - `race condition`
    - ë‹¤ì¤‘ í”„ë¡œì„¸ìŠ¤ í™˜ê²½ì—ì„œÂ **ë‘ ê°œ ì´ìƒì˜ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— ìˆ˜í–‰**Â ë  ë•Œ ë°œìƒë˜ëŠ” ë¹„ì •ìƒì ì¸ ìƒíƒœë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ë™ì‹œ ìˆ˜í–‰ì€Â **ì‹¤í–‰ ê²°ê³¼ì˜ ì¼ê´€ì„±ì„ ë³´ì¥í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.**Â ì—¬ëŸ¬ ê°œì˜ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë™ì‹œì— ì‹¤í–‰í•œë‹¤ë©´ ë¬´ìŠ¨ ì •ë³´ê°€ ë¨¼ì € ë“¤ì–´ì˜¬ ì§€ ë§¤ ì‹¤í–‰ë§ˆë‹¤ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê³ ì asyncì˜ ìœ„ì¹˜ë¥¼ ì•ˆ ìª½ìœ¼ë¡œ ë„£ìœ¼ë¼ê³  í•œ ê²ƒì…ë‹ˆë‹¤.

  ```jsx
  // ì˜ˆì‹œ 1 í•´ê²° ë°©ë²•
  // fetchDataë¼ëŠ” ë¹„ë™ê¸°ì  í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.
  // í˜¹ì€ thenì„ ì´ìš©í•´ì„œ ë°ì´í„° ë¡œë“œê°€ ì™„ë£Œëœ í›„ì—ë§Œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  import React, { useState, useEffect } from 'react'
  import axios from 'axios'

  export default () => {
    const [data, setData] = useState({ hits: [] })
    useEffect(() => {
      // fetchDataë€ ë¹„ë™ê¸°í•¨ìˆ˜ ìƒì„±
      const fetchData = async () => {
        const result = await axios(
          'https://hn.algolia.com/api/v1/search?query=redux'
        )
        setData(result.data)
      }

      fetchData()
    }, [])
    return (
      <ul>
        {data.hits.map((item) => (
          <li key={item.objectID}>
            <a href={item.url}>{item.title}</a>
          </li>
        ))}
      </ul>
    )
  }
  ```

2.  ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì½ì–´ì˜¤ê¸°(Reading from local storage)
3.  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡/í•´ì œ (Registering and deregistering event listeners)

    - ì™œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ useEffect() ë‚´ì—ì„œ ë“±ë¡í•´ì•¼ í• ê¹Œ?

      1.  ë©”ëª¨ë¦¬ ê´€ë¦¬

          - ë§Œì•½ useEffect ë°–ì—ì„œ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  í•´ì œí•˜ê²Œ ë˜ë©´ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë  ë•Œë§ˆë‹¤ windowì— í•¸ë“¤ëŸ¬ë¥¼ ê³„ì† ì¶”ê°€í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ëŸ¬ë‹¤ë³´ë©´ ë­”ê°€ ì˜ë„ì¹˜ ì•Šì€ ë™ì‘ì„ í•˜ê²Œ ë˜ê¸°ë„ í•˜ê³ , ë©”ëª¨ë¦¬ì ìœ¼ë¡œ ë¬¸ì œê°€ ìƒê¸°ê¸°ë„ í•œë‹¤.
                ```jsx
                function App() {
                  const [state, setState] = useState<number>(0);
                  console.log('rerender');
                  const handler = () => {
                    console.log('hi');
                  }
                  return (
                    <>
                      <p>{state}</p>
                      <button onClick={() => {
                        window.addEventListener('keydown', handler)
                        setState(state + 1);
                      }}>add</button>
                      <button onClick={() => {
                        window.removeEventListener('keydown', handler);
                        setState(state - 1);
                      }}>remove</button>
                    </>
                  );
                }
                ```

      2.  useEffectì˜ ì˜ì¡´ì„± ë°°ì—´ì„ ì‚¬ìš©í•˜ë©´ ìº¡ì³ë§ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì–´ìš”.

          ```jsx
          function App() {
            const [state, setState] = useState < number > 0
            const handler = () => {
              console.log(state)
            }
            useEffect(() => {
              window.addEventListener('keydown', handler)
            }, [])
            return (
              <>
                <p>{'Current: ' + state}</p>
                <button
                  onClick={() => {
                    setState(state + 1)
                  }}
                >
                  add
                </button>
              </>
            )
          }
          ```

          - ì•„ë˜ì²˜ëŸ¼í•˜ë©´ ì½˜ì†”ì°½ì— ê³„ì† 0ì´ ì°íŒë‹¤.
          - ì™œ ê·¸ëŸ´ê¹Œ? ì™œëƒë©´Â `window.addEventListener`Â ê°€ í˜¸ì¶œë˜ëŠ” ì‹œì ì—ì„œì˜Â `handler`Â ë¡œ ê³ ì •ì´ ë˜ì–´ë²„ë¦¬ê¸° ë•Œë¬¸ì´ë‹¤.
          - ì´ëŸ´ ê²½ìš°ì— ì˜ì¡´ì„± ë°°ì—´ì— state ê°’ì„ ë„£ì–´ì£¼ê²Œ í•˜ë©´Â `state`Â ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ê¸°ì¡´ì˜ Event Listenerê°€ ì‚¬ë¼ì§€ê³  ìƒˆë¡œìš´ ê°’ì´ ë°˜ì˜ëœ Event Listenerê°€ ì¶”ê°€ë˜ê¸° ë•Œë¬¸ì— ìš°ë¦¬ê°€ ì˜ë„í•œëŒ€ë¡œ ë™ì‘í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

# **useEffect ì‚¬ìš©ì‹œ ë§ˆì§€ë§‰ ì£¼ì˜ì‚¬í•­**

> useEffect ì‚¬ìš© ì‹œì˜ ë¬´í•œë£¨í”„ë¥¼ ë°©ì§€í•˜ë ¤ë©´?

- useEffectì˜ dependencyëŠ” ë¹ˆ ë°°ì—´ì´ë¼ë„ ë„˜ê²¨ ì£¼ê¸°
- useEffectì˜ dependencyê°€ useEffectì˜ ë‚´ë¶€ì—ì„œ ë³€ê²½ë˜ì§€ ì•Šë„ë¡ í•˜ê¸°

  ```jsx
  useEffect(() => {
    setCount(count + 1)
  })
  ```

  - ì²˜ìŒ ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ ë  ë•Œ, countì˜ ê°’ì„, 1ì¦ê°€ ì‹œí‚µë‹ˆë‹¤. ê·¸ëŸ°ë°Â `setCount`ë¥¼ í†µí•´ì„œ ì¦ê°€ì‹œì¼°ê¸° ë–„ë¬¸ì— í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ëŠ”Â **ë‹¤ì‹œ ë Œë”ë§ ë˜ê³ **, ë‹¤ì‹œ ë Œë”ë§ ë˜ì—ˆê¸° ë–„ë¬¸ì—,Â `useEffect`ì•ˆì— ìˆëŠ” ì½”ë“œê°€ í•œë²ˆ ë” ëŒê³ â€¦ í›Œë¥­í•œ ë¬´í•œ ë£¨í”„ ì½”ë“œì…ë‹ˆë‹¤!
    - íŠ¹ì • ê°’ì´ ë³€í™”ë˜ì—ˆì„ ë•Œë§Œ í•´ë‹¹ ì½”ë“œê°€ ì‹¤í–‰ë˜ê²Œ í•˜ê¸° (`deps`Â ì´ìš©)
